SELECT K_prime.ordid, O_prime.odate, K_prime.price_times_qty FROM (SELECT K.ordid, SUM(P.price*K.qty) AS price_times_qty FROM (SELECT * FROM (SELECT O.ordid AS ordid_prime, O.odate FROM Orders O WHERE O.ordid NOT IN (SELECT I.ordid FROM Invoices I)) J , Details D WHERE J.ordid_prime = D.ordid) K, Products P WHERE K.pcode = P.pcode GROUP BY K.ordid) K_prime, Orders O_prime WHERE K_prime.ordid = O_prime.ordid;
